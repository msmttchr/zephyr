
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Getting Started with Nucleo-WBA65RI and Nucleo-WBA55CG on Ubuntu &#8212; RCP BLE and Openthread 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="_static/bizstyle.css?v=5283bb3d" />
    
    <script src="_static/documentation_options.js?v=2709fde1"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/bizstyle.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html">RCP BLE and Openthread 0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Getting Started with Nucleo-WBA65RI and Nucleo-WBA55CG on Ubuntu</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="getting-started-with-nucleo-wba65ri-and-nucleo-wba55cg-on-ubuntu">
<span id="nucleo-wbaxx-comprehensive-setup"></span><h1>Getting Started with Nucleo-WBA65RI and Nucleo-WBA55CG on Ubuntu</h1>
<p>This guide describes how to:</p>
<ul class="simple">
<li><p>Prepare the <strong>NUCLEO-WBA65RI</strong> and <strong>NUCLEO-WBA55CG</strong> hardware
(flow control configuration).</p></li>
<li><p>Configure <strong>Ubuntu</strong> to work with these boards without requiring root.</p></li>
<li><p>Use the <strong>Python UART multiplexer</strong> to share a single UART with multiple
software components (BLE, OpenThread, system console).</p></li>
</ul>
<p>After following these steps you will be able to connect to the boards,
debug with ST-LINK, and attach multiple protocol stacks to the same UART.</p>
<section id="prerequisites">
<h2>Prerequisites</h2>
<p>Before you start, ensure you have:</p>
<ul class="simple">
<li><p>A <strong>NUCLEO-WBA65RI</strong> or <strong>NUCLEO-WBA55CG</strong> board.</p></li>
<li><p>A Linux host running Ubuntu.</p></li>
<li><p>Python 3 installed on the host.</p></li>
</ul>
</section>
<section id="step-1-nucleo-board-setup">
<h2>Step 1: NUCLEO Board Setup</h2>
<section id="hardware-flow-control-configuration">
<h3>Hardware Flow Control Configuration</h3>
<p>To enable <strong>RTS/CTS</strong> hardware flow control on the secondary Virtual COM
port (VCP2), the solder bridges must be configured differently on
<strong>NUCLEO-WBA65RI</strong> and <strong>NUCLEO-WBA55CG</strong>.</p>
<section id="nucleo-wba65ri-usart2-vcp2">
<h4>NUCLEO-WBA65RI (USART2 / VCP2)</h4>
<p>On NUCLEO-WBA65RI, VCP2 is connected to <strong>USART2</strong> of STM32WBA65RI.
To use <strong>PA15</strong> as RTS (default as per UM3448, Table 7), configure the
solder bridges on the mezzanine board <strong>MB1801</strong> as follows:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Solder Bridge</p></th>
<th class="head"><p>Position</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>SB4</strong></p></td>
<td><p><strong>ON</strong> (Closed)</p></td>
<td><p>Connects USART2_RTS (PA15) to ST-LINK CTS</p></td>
</tr>
<tr class="row-odd"><td><p><strong>SB7</strong></p></td>
<td><p><strong>OFF</strong> (Open)</p></td>
<td><p>Disconnects alternative PA15 routing</p></td>
</tr>
</tbody>
</table>
<p>Other VCP2 signals (per UM3448, Table 7):</p>
<ul class="simple">
<li><p><strong>USART2_RX (PA11)</strong> → ST-LINK TX (PC10) via CN4/pin 37</p></li>
<li><p><strong>USART2_TX (PA12)</strong> → ST-LINK RX (PB11) via CN4/pin 35
(<cite>SB16 ON</cite>, <cite>SB13 OFF</cite> by default)</p></li>
<li><p><strong>USART2_CTS (PB15)</strong> → ST-LINK RTS (PD12) via CN4/pin 26</p></li>
</ul>
</section>
<section id="nucleo-wba55cg-lpuart1-vcp2">
<h4>NUCLEO-WBA55CG (LPUART1 / VCP2)</h4>
<p>On NUCLEO-WBA55CG, the second Virtual COM port (VCP2) uses <strong>LPUART1</strong>
of STM32WBA55CG (see UM3301, Section 7.4.5, Table 8). VCP2 replaces the
mass‑storage interface when enabled.</p>
<ol class="arabic">
<li><p><strong>Enable VCP2 TX/RX on MB1801 (mezzanine)</strong></p>
<p>Close the following solder bridges on <strong>MB1801</strong>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Solder Bridge</p></th>
<th class="head"><p>Position</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>SB7</strong></p></td>
<td><p><strong>ON</strong> (Closed)</p></td>
<td><p>Connects LPUART1_RX (PA10)
to ST-LINK TX (PC10)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>SB8</strong></p></td>
<td><p><strong>ON</strong> (Closed)</p></td>
<td><p>Connects LPUART1_TX (PB5)
to ST-LINK RX (PB11)</p></td>
</tr>
</tbody>
</table>
</li>
<li><p><strong>Route CTS/RTS on MB1801 (mezzanine)</strong></p>
<p>On <strong>MB1801</strong>, these bridges control RTS/CTS connection between
ST-LINK and the SoC (see UM3301, Table 8):</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Solder Bridge</p></th>
<th class="head"><p>Position</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>SB25</strong></p></td>
<td><p><strong>ON</strong> (Closed)</p></td>
<td><p>Routes ST-LINK_RTS (PD12)
towards the SoC CTS path</p></td>
</tr>
<tr class="row-odd"><td><p><strong>SB23</strong></p></td>
<td><p><strong>ON</strong> (Closed)</p></td>
<td><p>Routes ST-LINK_CTS (PD11)
towards the SoC RTS path</p></td>
</tr>
</tbody>
</table>
</li>
<li><p><strong>Select CTS/RTS pins on MB1803 (MCU RF board)</strong></p>
<p>On <strong>MB1803</strong> you choose which STM32WBA55CG pins carry CTS and RTS:</p>
<p><strong>CTS (LPUART1_CTS, from ST-LINK_RTS):</strong></p>
<ul>
<li><p>To use <strong>PB15</strong> as CTS:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Solder Bridge</p></th>
<th class="head"><p>Position</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>SB32</strong></p></td>
<td><p><strong>ON</strong> (Closed)</p></td>
<td><p>Connects CTS signal to PB15</p></td>
</tr>
<tr class="row-odd"><td><p><strong>SB31</strong></p></td>
<td><p><strong>OFF</strong> (Open)</p></td>
<td><p>Disconnects alternative path</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
<p><strong>RTS (LPUART1_RTS on PB9, from ST-LINK_CTS):</strong></p>
<ul>
<li><p>To use <strong>PB9</strong> as RTS:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Solder Bridge</p></th>
<th class="head"><p>Position</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>SB25</strong></p></td>
<td><p><strong>ON</strong> (Closed)</p></td>
<td><p>Connects RTS signal to PB9</p></td>
</tr>
<tr class="row-odd"><td><p><strong>SB23</strong></p></td>
<td><p><strong>OFF</strong> (Open)</p></td>
<td><p>Disconnects alternative path</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
<p>With this configuration, VCP2 signals are:</p>
<ul class="simple">
<li><p><strong>TX / RX</strong>: LPUART1_TX (PB5) / LPUART1_RX (PA10)</p></li>
<li><p><strong>CTS</strong>: LPUART1_CTS on PB15 (via SB32/SB31)</p></li>
<li><p><strong>RTS</strong>: LPUART1_RTS on PB9 (via SB25/SB23)</p></li>
</ul>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Enabling VCP2 on either board replaces the ST-LINK mass‑storage
interface with a second Virtual COM port. Follow UM3448 (WBA65RI) and
UM3301 (WBA55CG) for the required ST-LINK firmware configuration.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Use a fine-tip soldering iron and appropriate ESD precautions. Always
verify solder bridge locations and default states against the latest
user manuals (UM3448 for <strong>NUCLEO-WBA65RI</strong>, UM3301 for
<strong>NUCLEO-WBA55CG</strong>) before modification.</p>
</div>
</section>
</section>
</section>
<section id="step-2-ubuntu-setup">
<h2>Step 2: Ubuntu Setup</h2>
<p>In this step you configure Ubuntu so that:</p>
<ul class="simple">
<li><p>A normal user can access the serial ports.</p></li>
<li><p>The system does not interfere with the Nucleo serial interface.</p></li>
<li><p>ST-LINK can be used without <code class="code docutils literal notranslate"><span class="pre">sudo</span></code>.</p></li>
</ul>
<p>These steps are common to both <strong>NUCLEO-WBA65RI</strong> and <strong>NUCLEO-WBA55CG</strong>.</p>
<section id="system-permissions-conflicts">
<h3>System Permissions &amp; Conflicts</h3>
<ol class="arabic">
<li><p><strong>Add the user to the dialout group</strong></p>
<p>Grant permission to access serial devices:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>dialout<span class="w"> </span><span class="nv">$USER</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must log out and log back in for this change to take effect.</p>
</div>
</li>
<li><p><strong>Disable ModemManager</strong></p>
<p>Prevent the system from sending AT commands to the Nucleo:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>ModemManager
sudo<span class="w"> </span>systemctl<span class="w"> </span>disable<span class="w"> </span>ModemManager
</pre></div>
</div>
</li>
</ol>
</section>
<section id="st-link-udev-rules">
<h3>ST-LINK Udev Rules</h3>
<p>Create a udev rule to allow ST-LINK/V3 access without <code class="code docutils literal notranslate"><span class="pre">sudo</span></code>:</p>
<ol class="arabic">
<li><p><strong>Create the udev rules file</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/udev/rules.d/49-stlinkv3.rules
</pre></div>
</div>
</li>
<li><p><strong>Add the following content:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># ST-LINK/V3 (used by NUCLEO-WBA65RI and NUCLEO-WBA55CG)
SUBSYSTEMS==&quot;usb&quot;, ATTRS{idVendor}==&quot;0483&quot;, ATTRS{idProduct}==&quot;374d&quot;, MODE=&quot;0666&quot;, GROUP=&quot;dialout&quot;
SUBSYSTEMS==&quot;usb&quot;, ATTRS{idVendor}==&quot;0483&quot;, ATTRS{idProduct}==&quot;374e&quot;, MODE=&quot;0666&quot;, GROUP=&quot;dialout&quot;
SUBSYSTEMS==&quot;usb&quot;, ATTRS{idVendor}==&quot;0483&quot;, ATTRS{idProduct}==&quot;374f&quot;, MODE=&quot;0666&quot;, GROUP=&quot;dialout&quot;
</pre></div>
</div>
</li>
<li><p><strong>Reload udev rules:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>udevadm<span class="w"> </span>control<span class="w"> </span>--reload-rules
sudo<span class="w"> </span>udevadm<span class="w"> </span>trigger
</pre></div>
</div>
</li>
</ol>
<p>At this point, reconnect the Nucleo board’s USB cable to ensure the
new rules are applied.</p>
</section>
</section>
<section id="step-3-python-uart-multiplexer">
<h2>Step 3: Python UART Multiplexer</h2>
<section id="overview">
<h3>Overview</h3>
<p>The <code class="file docutils literal notranslate"><span class="pre">uart_mux_asyncio.py</span></code> script bridges a single physical UART port
to multiple virtual PTYs. This allows you to run:</p>
<ul class="simple">
<li><p>A BLE stack (e.g., BlueZ via HCI)</p></li>
<li><p>An OpenThread stack (via Spinel)</p></li>
<li><p>A system console or management interface</p></li>
</ul>
<p>all over the same physical UART.</p>
<p>The usage is identical for <strong>NUCLEO-WBA65RI</strong> and <strong>NUCLEO-WBA55CG</strong>.</p>
</section>
<section id="installing-dependencies">
<h3>Installing Dependencies</h3>
<p>Install the asynchronous serial dependency:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>pyserial-asyncio
</pre></div>
</div>
</section>
<section id="basic-usage">
<h3>Basic Usage</h3>
<p>The script maps the physical port (for example, <code class="file docutils literal notranslate"><span class="pre">/dev/ttyACM1</span></code>) to
three virtual channels.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic launch (same for WBA65RI and WBA55CG)</span>
python3<span class="w"> </span>uart_mux_asyncio.py<span class="w"> </span>--port<span class="w"> </span>/dev/ttyACM1<span class="w"> </span>--baudrate<span class="w"> </span><span class="m">2000000</span>

<span class="c1"># Launch with automatic Bluetooth and OpenThread attachment</span>
sudo<span class="w"> </span>python3<span class="w"> </span>uart_mux_asyncio.py<span class="w"> </span>--bt-attach<span class="w"> </span>--ot-manager<span class="w"> </span>ot-daemon
</pre></div>
</div>
</section>
<section id="key-command-line-arguments">
<h3>Key Command-Line Arguments</h3>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">--port</span></code>:
Serial port device (default: <code class="file docutils literal notranslate"><span class="pre">/dev/ttyACM0</span></code>).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--baudrate</span></code>:
Communication speed (default: <code class="code docutils literal notranslate"><span class="pre">2000000</span></code>).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--rtscts</span></code>:
Enable hardware flow control (requires SB4/SB7 hardware modification).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--bt-attach</span></code>:
Spawns <code class="code docutils literal notranslate"><span class="pre">btattach</span></code> on the BLE channel (requires root).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--ot-manager</span></code>:
Spawns <code class="code docutils literal notranslate"><span class="pre">ot-daemon</span></code> or <code class="code docutils literal notranslate"><span class="pre">otbr-agent</span></code> on the OpenThread channel
(requires root).</p></li>
</ul>
</section>
<section id="interactive-mode">
<h3>Interactive Mode</h3>
<p>While the script is running, you can interact with it directly from the
terminal:</p>
<ul class="simple">
<li><p><strong>Press ‘i’</strong>:
Displays the current status of the PTYs and the PIDs of attached daemons.</p></li>
<li><p><strong>Press ‘q’</strong>:
Safely shuts down the multiplexer and cleans up virtual devices.</p></li>
</ul>
</section>
<section id="virtual-device-mapping">
<h3>Virtual Device Mapping</h3>
<p>The script creates three PTYs. Look for the following lines in the terminal
output to identify the virtual device paths:</p>
<ul class="simple">
<li><p><strong>BLE</strong>:
Use this for BlueZ / HCI communication.</p></li>
<li><p><strong>OT</strong>:
Use this for OpenThread Spinel communication.</p></li>
<li><p><strong>System</strong>:
Use this for console or management frames.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you see “staircase” text in your terminal, the script includes a
custom logger to handle the translation between Linux LF and Serial CR/LF
while in raw/cbreak mode.</p>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html">RCP BLE and Openthread 0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Getting Started with Nucleo-WBA65RI and Nucleo-WBA55CG on Ubuntu</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2026, STMicroelectronics.
      Last updated on 2026-01-18 22:02:06.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>